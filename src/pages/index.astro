---
import Layout from '../layouts/Layout.astro';
import TicketForm from '../components/TicketForm.astro';
import { supabase } from '../db/supabase';

// Define the Ticket interface
interface Ticket {
  id: number;
  name: string;
  department: string;
  description: string;
  importance: string;
  status: string;
  created_at: string;
}

// Fetch tickets from Supabase with correct type annotation
const { data: tickets, error } = await supabase
  .from('tickets')
  .select('*')
  .order('created_at', { ascending: false }) as { data: Ticket[] | null, error: any };

if (error) {
  console.error('Error fetching tickets:', error);
}
---

<Layout title="Submit a Ticket">
  <h1>Submit a Ticket</h1>
  <TicketForm />

  <h2>Recent Tickets</h2>
  {tickets && tickets.length > 0 ? (
    <ul>
      {tickets.map((ticket: Ticket) => (
        <li>
          <strong>{ticket.name}</strong> - {ticket.department} - {ticket.importance}
          <p>{ticket.description}</p>
        </li>
      ))}
    </ul>
  ) : (
    <p>No tickets found.</p>
  )}
</Layout>

<style>
  ul {
    list-style-type: none;
    padding: 0;
  }
  li {
    margin-bottom: 1rem;
    padding: 1rem;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
</style>